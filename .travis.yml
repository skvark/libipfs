sudo: required

language: cpp

services:
  - docker

before_install:
  - ls
  - docker pull coderus/sailfishos-platform-sdk:2.2.0.29
  - docker run -it --mount type=bind,source="$(pwd)",target=/home/nemo/libipfs-git -d --name build-engine coderus/sailfishos-platform-sdk:2.2.0.29 /bin/bash
  - docker exec build-engine sb2 -t SailfishOS-2.2.0.29-armv7hl -m sdk-install -R zypper --non-interactive --no-gpg-checks ar -f http://repo.merproject.org/obs/home:/skvark/sailfish_latest_armv7hl go
  - docker exec build-engine sb2 -t SailfishOS-2.2.0.29-armv7hl -m sdk-install -R zypper --non-interactive --no-gpg-checks ref
  - docker exec build-engine ssh-keyscan -t rsa github.com >> ~/.ssh/known_hosts

script:
  - docker exec build-engine bash -c "cd /home/nemo
    && cp -r libipfs-git libipfs
    && cd libipfs
    && sudo ln -s /srv/mer/toolings/SailfishOS-2.2.0.29/opt/cross/bin/armv7hl-meego-linux-gnueabi-as /srv/mer/toolings/SailfishOS-2.2.0.29/opt/cross/libexec/gcc/armv7hl-meego-linux-gnueabi/4.8.3/as
    && sudo ln -s /srv/mer/toolings/SailfishOS-2.2.0.29/opt/cross/bin/armv7hl-meego-linux-gnueabi-ld /srv/mer/toolings/SailfishOS-2.2.0.29/opt/cross/libexec/gcc/armv7hl-meego-linux-gnueabi/4.8.3/ld
    && mb2 -t SailfishOS-2.2.0.29-armv7hl build"